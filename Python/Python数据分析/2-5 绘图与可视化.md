# 绘图与可视化

信息可视化（也叫绘图）是数据分析中最重要的工作之一，
Python有许多库进行静态或动态的数据可视化，`Matplotlib` 是最核心、最著名的二维绘图库。

## 基础绘图流程

```python
import matplotlib.pyplot as plt

x = [1, 2, 3, 4, 5]
y = [2, 4, 1, 5, 3]
plt.plot(x, y)          # 绘制折线图
plt.title("简单折线图")  # 标题
plt.xlabel("X轴")       # X轴标签
plt.ylabel("Y轴")       # Y轴标签
plt.show()              # 显示图形
```

中文乱码需要添加如下配置
```python
plt.rcParams['font.sans-serif'] = ['SimHei']  # 黑体
plt.rcParams['axes.unicode_minus'] = False    # 解决负号显示问题
```

## Figure和Subplot

类比一下生活中用纸笔绘图，我们需要先找到一张白纸， 在白纸上绘图。
使用Matplotlib面向对象绘图，绘图前我们要先创建一个Figure对象，Figure对象就相当于是白纸，
AxesSubplot就相当于白纸上的绘图区，拥有自己独立的坐标系统。

### 创建画布和子图

逐个追加
```python
fig = plt.figure()
axes1 = fig.add_subplot(2,2,1)
axes2 = fig.add_subplot(2,2,2)
axes3 = fig.add_subplot(2,2,3)
```

创建单个画布与子图
```python
x = [1, 2, 3, 4, 5]
y = [2, 4, 1, 5, 3]

fig, ax = plt.subplots()
ax.plot(x, y)
ax.set_title('single subplot')
plt.show()
```

创建多个子图
```python
x = np.arange(0, 10)
y = np.sin(x)
data = np.random.randn(1000)

fig, axes = plt.subplots(2, 2, figsize=(10, 6))
axes[0,0].plot(x, y)
axes[0,1].scatter(x, y)
axes[1,0].bar(x, y)
axes[1,1].hist(data, bins=30, edgecolor='black')
plt.show()
```

## 图形样式和定制

### 颜色、线性与标记

```python
x = np.array([1, 2, 3, 4, 5])
y = np.array([2, 4, 6, 8, 10])

# 颜色示例
colors = ['red', 'blue', 'green', 'orange', 'purple']

# 线型示例
linestyles = ['-', '--', '-.', ':']

# 标记示例
markers = ['o', 's', '^', 'D', 'v']

fig, ax = plt.subplots(figsize=(10, 6))

for i in range(5):
    y = np.sin(x + i * 0.5)
    ax.plot(x, y,
             color=colors[i],
             linestyle=linestyles[i % 4],
             marker=markers[i],
             markersize=6,
             markevery=10,
             label=f'曲线 {i+1}')
plt.show()
```

### 刻度、标签与图例

```python
x = np.arange(10)
fig, axes = plt.subplots(figsize=(10, 6))
axes.plot(x, np.sin(x), label="图例标签")

# 设置坐标轴范围
axes.set_xlim(0, 12)
axes.set_ylim(-1.5, 1.5)

# 设置刻度
axes.set_xticks([0, 2, 4, 6, 8, 10, 12])
axes.set_yticks([-1, -0.5, 0, 0.5, 1])

# 添加网格
axes.grid(True, linestyle='--', alpha=0.7)

# 设置坐标轴标签
axes.set_xlabel('时间 (秒)', fontsize=12)
axes.set_ylabel('振幅', fontsize=12)
axes.set_title('定制坐标轴示例', fontsize=14)
# 添加图例
axes.legend()
plt.show()
```

## 注解

### 文本注解

```python
# 创建基础图表
fig, ax = plt.subplots(figsize=(10, 6))
x = np.linspace(0, 10, 100)
y = np.sin(x)

ax.plot(x, y)
ax.grid(True, alpha=0.3)

# 添加文本注解
ax.text(2, 0.5, '文本注解', fontsize=12,
        bbox=dict(boxstyle='round', facecolor='wheat', alpha=0.8))

# 在数据点添加注解
max_point = (np.pi/2, 1)
ax.text(max_point[0], max_point[1] + 0.1, '最大值点',
        ha='center', va='bottom', fontsize=10,
        bbox=dict(boxstyle='round,pad=0.3', facecolor='yellow', alpha=0.7))

plt.show()
```

### 箭头注解

```python
x = np.linspace(0, 10, 100)
y = np.sin(x)

fig, ax = plt.subplots(figsize=(10, 6))
ax.plot(x, y)
ax.grid(True, alpha=0.3)

# 添加带箭头的注解
ax.annotate('最大值', xy=(np.pi/2, 1), xytext=(4, 0.5),
            arrowprops=dict(arrowstyle='->', connectionstyle='arc3', color='red'),
            fontsize=12, bbox=dict(boxstyle='round', facecolor='lightblue', alpha=0.8))

# 另一个箭头注解示例
ax.annotate('零点', xy=(np.pi, 0), xytext=(8, -0.5),
            arrowprops=dict(arrowstyle='fancy', color='green', lw=2),
            fontsize=12)

plt.show()
```

### 图形

```python
# 创建画布
fig, ax = plt.subplots(figsize=(10, 8))
ax.set_xlim(0, 10)
ax.set_ylim(0, 10)
ax.set_aspect('equal')  # 保持纵横比相等
ax.grid(True, alpha=0.3)

# 方法1：使用 patches.Rectangle
rect = patches.Rectangle(
        (1, 1),           # 左下角坐标 (x, y)
        3, 2,             # 宽度和高度
        linewidth=2,      # 边框线宽
        edgecolor='blue', # 边框颜色
        facecolor='lightblue',  # 填充颜色
        alpha=0.7,        # 透明度
        label='矩形1'
)
ax.add_patch(rect)

circle = patches.Circle(
        (3, 7),           # 圆心坐标 (x, y)
        1.5,              # 半径
        linewidth=2,
        edgecolor='purple',
        facecolor='violet',
        alpha=0.7,
        label='圆形1'
)
ax.add_patch(circle)

# 顶点坐标
triangle_verts = np.array([[2, 4], [4, 4], [3, 6]])
triangle = patches.Polygon(
        triangle_verts,
        closed=True,      # 是否闭合
        linewidth=2,
        edgecolor='darkgreen',
        facecolor='lightgreen',
        alpha=0.7,
        label='三角形'
)
ax.add_patch(triangle)
plt.show()
```

## 保存至文件

`plt.savefig()` 和 `Figure.savefig()` 都可以实现图像快速保存，区别在于作用对象。`plt.savefig()`适用与快速保存当前绘图，
`Figure.savefig()` 则可以指定 Figure 对象，更灵活一些。

```python
import matplotlib.pyplot as plt

# 绘制图形
plt.plot([1, 2, 3], [4, 5, 6])
plt.xlabel("X轴")
plt.ylabel("Y轴")

# 保存图像（默认保存为PNG格式）
plt.savefig('output.png')
```

参数说明:

- fname: 文件名（可包含路径），支持PNG,SVG,PDF,JPG,EPS,TIFF
- dpi: 分辨率（默认100）
- bbox_inches: 去除白边
- facecolor/edgecolor: 设置背景色和边框色
- transparent: 透明背景（PNG格式适用）

## 全局配置
`plt.rc()` 函数是 Matplotlib 中用于设置全局参数的主要方法之一，它提供了一种分组设置的方式，比直接操作 `rcParams` 字典更加清晰和结构化

```python
plt.rc('font', family='SimHei', size=12)          # 中文字体支持
plt.rc('lines', linewidth=2, markersize=8)        # 线条样式
plt.rc('axes', grid=True, titlesize=16)           # 坐标轴设置
plt.rc('xtick', labelsize=12)                     # X轴刻度
plt.rc('ytick', labelsize=12)                     # Y轴刻度
plt.rc('figure', figsize=(10, 6), dpi=100)        # 图形设置
plt.rc('savefig', dpi=300, format='png')          # 保存设置
```

## Pandas 与 Seaborn
在数据可视化中，`Pandas` 和 `Seaborn` 都是基于 `Matplotlib` 的高级封装，但它们在用法和功能上有所不同

```python
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

# 创建示例 DataFrame
df = pd.DataFrame({
    'A': [1, 2, 3, 4],
    'B': [2, 4, 6, 8],
    'C': [1, 3, 5, 7]
})

# 基本绘图 (默认绘制所有列的折线图)
df.plot()
plt.show()

# 其他类型
# 折线图
df.plot(kind='line', figsize=(10, 6), title='折线图')
plt.show()

# 垂直柱状图
df.tail(10).plot(kind='bar', figsize=(10, 6), title='柱状图')
plt.show()

# 水平柱状图
df.tail(10).plot(kind='barh', title='水平柱状图')
plt.show()

# 直方图
df.plot(kind='hist', bins=20, alpha=0.7, figsize=(10, 6), title='直方图')
plt.show()
```


### Seaborn
seaborn的绘制函数数据参数

- data: DataFrame，输入数据
- x, y: 字符串，指定 DataFrame 中作为 x 轴和 y 轴的列名

```python
import seaborn as sns
import matplotlib.pyplot as plt

# 加载示例数据集
tips = sns.load_dataset("tips")

tips.head()
#    total_bill   tip     sex smoker  day    time  size
# 0       16.99  1.01  Female     No  Sun  Dinner     2
# 1       10.34  1.66    Male     No  Sun  Dinner     3
# 2       21.01  3.50    Male     No  Sun  Dinner     3
# 3       23.68  3.31    Male     No  Sun  Dinner     2
# 4       24.59  3.61  Female     No  Sun  Dinner     4


# 绘制散点图（x-y 关系）
sns.relplot(
    data=tips,
    x="total_bill",
    y="tip",
    kind="scatter"  # 默认类型，可省略
)
plt.show()
```

### Seaborn 绘图分类

#### 关系图
展示两个或多个连续变量之间的关系

1. `scatterplot()` - 散点图
2. `lineplot()` - 折线图
3. `relplot()` - 关系图的通用函数

适用场景:  
1. 相关性分析
2. 趋势观察
3. 聚类识别
4. 异常值检测

#### 分类图

比较分类变量与数值变量之间的关系

1. `barplot()` - 柱状图
2. `countplot()` - 计数图
3. `boxplot()` - 箱线图
4. `violinplot()` - 小提琴图
5. `stripplot()` - 带状图
6. `swarmplot()` - 蜂群图
7. `catplot()` - 分类图的通用函数

适用场景:  
1. 组间比较
2. 分布分析
3. 异常值识别
4. 数据分布可视化

#### 分布图

显示单变量或多变量的分布情况

1. `histplot()` - 直方图
2. `kdeplot()` - 核密度估计图
3. `ecdfplot()` - 经验累积分布函数图
4. `displot()` - 分布图的通用函数

适用场景:  
1. 数据分布探索
2. 正态性检验
3. 偏度和峰度分析
4. 多组数据比较

#### 回归图
显示变量间的线性关系并拟合回归线

1. `regplot()` - 回归图
2. `lmplot()` - 线性模型图

适用场景:  
1. 线性关系验证
2. 趋势预测
3. 异常点识别
4. 多组比较

#### 矩阵图
显示矩阵形式的数据结构

1. `heatmap()` - 热力图
2. `clustermap()` - 聚类热力图

适用场景:  
1. 相关性分析
2. 聚类分析
3. 模式识别
4. 数据矩阵可视化

#### 多图网格
创建基于条件变量的多个子图

1. `FacetGrid` - 分面网格
2. `PairGrid` - 配对网格
3. `jointplot()` - 联合分布图
4. `pairplot()` - 配对图

使用场景:  
1. 多条件数据比较
2. 高维数据探索
3. 变量关系综合分析
4. 分组数据可视化
