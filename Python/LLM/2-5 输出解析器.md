# 输出解析器
目的: 用于将 LLM 的非结构化文本输出转换为结构化数据

原理: 模板提示词注入(提示词示例: 输出必须为JSON格式) + 响应格式验证 + 错误处理机制(提示词示例: 请修正响应以满足格式要求)

## 结构化数据解析器
PydanticOutputParser - JSON 结构化输出

```python
from langchain.chat_models import ChatOpenAI
from langchain.prompts import ChatPromptTemplate
from langchain.output_parsers import PydanticOutputParser
from pydantic import BaseModel, Field
from typing import List

# 定义期望的输出结构
class StoryResponse(BaseModel):
    title: str = Field(description="故事标题")
    characters: List[str] = Field(description="角色列表")
    plot: str = Field(description="情节概要")
    moral: str = Field(description="寓意")

parser = PydanticOutputParser(pydantic_object=StoryResponse)

# 创建提示模板
prompt = ChatPromptTemplate.from_template("""
请根据以下主题写一个故事：
主题：{topic}

{format_instructions}
""")


# 初始化模型
chat = ChatOpenAI(
    model="Qwen3-Coder-Flash",
    openai_api_key = 'sk-',
    openai_api_base = '',
    temperature=0
)

# 构建链
chain = prompt | chat | parser

# 调用并获取结构化输出
result = chain.invoke({
    "topic": "勇敢的小狗",
    "format_instructions": parser.get_format_instructions()
})
print(result)
print(f"标题: {result.title}")
print(f"角色: {', '.join(result.characters)}")
print(f"情节: {result.plot}")
print(f"寓意: {result.moral}")
```