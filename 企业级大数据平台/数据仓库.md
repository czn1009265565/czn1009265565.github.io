# 数据仓库

数据仓库是将多个数据源经过ETL处理之后，按照一定**主题**集成起来提供决策支持和联机分析应用的结构化数据环境。

输入数据源:

- 业务数据
- 用户行为数据
- 爬虫数据

## 数据库 VS 数据仓库

1. 数据库是面向事务设计，数据仓库是面向主题设计
2. 数据库设计是避免冗余，采用三范式的设计规则。数据仓库设计是引入冗余，采用反范式的设计

## 数据仓库建设目标

1. 集成多源数据，数据来源和去向可追溯，梳理血缘关系
2. 减少重复开发，保存通用型中间数据，避免重复计算
3. 屏蔽底层业务逻辑，对外提供一致的、结构清晰的数据

## 实现步骤

1. 实现通用型ETL工具
2. 根据业务建立合理的数据分层模型

## 维度表与事实表

- 维度表: 一般是对事实的描述信息，每一张维度表对应现实世界的一个对象或者概念，例如用户、商品、地区等。
- 事实表: 每行数据代表一个业务事件(下单、支付、退款、评价等)

## 数据仓库分层建设
自下而上分为

1. STG 原始数据层
2. ODS 数据操作层 
3. DWD 数据明细层
4. DWS 原始汇总层
5. DIM 公共维度层
6. DM 数据集市层

### STG
原始数据层: 存储原始数据，数据结构与采集数据一致

存储周期: 保存全部数据

表命名规范: stg_主题_表内容_分表规则

### ODS(Operational Data Store)
数据操作层: 对原始数据进行初步处理，如去除脏数据、无用字段

存储周期: 保存近30天数据

表命名规范: ods_主题_表内容_分表规则

### DWD(Data Warehouse Detail)
数据明细层: 数据处理后的宽表，目标为满足80%业务需求

存储周期: 保存全部数据

表命名规范: dwd_业务描述_时间粒度

### DWS(Data Warehouse Summary)
原始汇总层: 汇总数据，解决数据汇总计算和数据完整度问题

存储周期: 保存全部数据

表命名规范: dws_业务描述_时间粒度_sum

### DIM

公共维度层: 存储公共信息，有点类似枚举表，例如国家地区编码

存储周期: 按需存储

表命名规范: dim_维度描述

### ADS/DM (Application Data Service/Data Mart)

数据集市层: 用于BI、多维分析、标签、数据挖掘等。为所有服务提供数据支持

存储周期: 保存全部数据

表命名规范: dm_主题_表内容_分表规则

## 离线数仓VS实时数仓

### 离线数仓
1. 主要基于Hive等技术来构建T+1的离线数据
2. 通过定时任务每天拉取增量数据导入到Hive表中
3. 创建各个业务相关的主题维度数据(ODS,DWD,DM)，对外提供T+1的数据查询接口

### 实时数仓
1. 数据仓库基于数据采集工具，将原始数据写入Kafka等数据通道
2. 数据最终写入到类似于HBase支持快速读写的存储系统
3. 对外提供分钟级别、甚至秒级的查询方案

