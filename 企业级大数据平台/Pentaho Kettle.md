# Pentaho Kettle
Kettle是一款由纯Java语言开发的免费开源的ETL工具,ETL即是Extract-Transform-Load的缩写,
用来描述将数据从来源端通过提取(Extract)、转换(Transform)、加载(Load)到目标端的过程, 通常用于数据清洗、数据迁移等.

## 安装和部署
Github地址: https://github.com/pentaho/pentaho-kettle

1. JDK安装部署
2. Kettle 安装部署，目前需要在Github下载源码手动编译

编译完成后,我们需要关注Kettle的几个关键目录和文件

- Spoon：图形界面工具，快速设计和维护复杂的ETL工作流。
- Kitchen：运行作业的命令行工具。
- Pan：运行转换的命令行工具。
- Carte：轻量级的（大概1MB）Web服务器，用来远程执行转换或作业。一个运行有Carte进程的机器可以作为从服务器，从服务器是Kettle集群的一部分。
- lib:该目录是Kettle依赖的第三方jar包目录,如果我们在使用Kettle进行数据库导入的话,此时如果Kettle中没有该数据库的驱动jar包时,我们需要将从网站上下载的驱动jar放到该lib目录下,然后重启程序进行调试,否则会报错(驱动类不存在)
- Encr:上面我们所说的创建数据库连接时,我们需要输入密码,但是我们的密码不能是明文,Encr工具为我们提供加密服务

## 核心概念
Kettle中两个核心的组件服务：转换和作业

- 转换：转换(transformation)是ETL解决方案中最主要的部分,它负责抽取、转换、加载各个阶段的数据操作处理,转换包括一个或多个步骤,
如读取文件、请求REST接口、插入数据、过滤数据等等,各个步骤之间通过Hop连接,Hop代表的是一个单向的数据流通道。通过:文件 => 新建 => 转换用以创建转换
- 作业：作业(job)通常是一组转换的集合,比如一个条件的判断,参数的轮训执行转换,因为转换的执行只能执行一次,
遇上分页接口的转换我们需要借助于作业的方式轮训执行转换以阶级数据的抽取工作,在作业中可以对转换的执行成功发送邮件服务等,通过:文件 => 新建 => 作业用以创建作业
- 跳：步骤间带箭头的连线
- 步骤（控件）：是转换里的基本组成部分。特性如下：  
  i. 步骤名称在转换范围内唯一  
  ii. 每个步骤都会读、写数据行（生成记录例外，生成记录只写数据）  
  iii. 步骤间通过跳连接
  iv. 大多数步骤可以有多个输出跳，在多个输出跳时可以选择分发或复制
- 元数据：每个步骤在输出行都有对字段的描述，这种描述就是数据行的元数据  
  i. 名称，数据行中的字段名是唯一的  
  ii. 数据类型，字段的数据类型  
  iii. 格式，数据显示方式，例如Integer的#，0，0.00。  
  iv. 长度，字符串或BigNumber的长度  
  v. 精度，BigNumber数据类型的十进制精度
- 并行：对于kettle的转换，不能定义一个执行顺序，因为所有步骤都以并发方式执行：当转换启动后，所有步骤都同时启动，从它们的输入跳中读取数据，并把处理过的数据写到输出跳，直到输入跳里不再有数据，就中止步骤的运行。当所有的步骤都中止了，整个转换就中止了。

## 转换

### CSV2Excel

1. 转换 => 输入 => CSV文件输入，将 `CSV文件输入` 拖动到画布中
2. 双击 `CSV文件输入`，浏览选择对应的CSV文件
3. 单击 `获取字段`，将我们需要的字段加载到kettle中
4. 转换 => 输出 => Excel输出，将 `Excel输出` 拖动到画布中
5. 按住Shift键，点击鼠标左键将两个控件连接，并选择主输出步骤
6. 双击 `Excel输出`控件，设置文件输出路径，并点击字段、获取字段，设置需要的输出字段
7. 点击左上角运行按钮

### 输入控件

输入是转换里面的第一个分类，输入控件也是转换中的第一大控件，用来抽取数据或者生成数据。输入是ETL里面的E（Extract），主要做数据提取的工作。

1. CSV文件输入
2. 文本文件输入
3. Excel输入
4. XML输入
5. JSON输入
6. 表输入（重要）

#### 表输入

1. 创建数据库连接之前，需要将数据库驱动放置Kettle安装目录下的lib文件夹下，并重启Kettle客户端Spoon
2. 菜单路径：主对象树 => 转换 => DB连接，右键新建，填写数据库连接并测试
3. 菜单路径：核心对象 => 输入 => 表输入，将 `表输入` 拖动到画布中
4. 双击 `表输入`，选择刚才创建的数据库连接，然后在SQL查询框内输入查询语句，点击预览


### 输出控件

输出是转换里面的第二个分类，输出控件也是转换中的第二大控件，用来存储数据

1. Excel输出
2. 文本文件输出
3. SQL文件输出：SQL文件输出一般跟表输入做连接，然后将数据库表的表结构和数据以SQL文件的形式导出
4. 表输出：表输出控件可以将kettle数据行中的数据直接写入到数据库中的表中
5. 更新、插入/更新：更新和插入/更新，这两个控件是kettle提供的将数据库已经存在的记录与数据流里面的记录进行对比的控件
6. 删除：删除控件可以删除数据库表中指定条件的数据，企业里一般用此控件做数据库表数据删除或者跟另外一个表数据做对比，然后进行去重的操作


### 转换控件

转换控件是转换里面的第四个分类，转换控件也是转换中的第三大控件，用来转换数据。转换是ETL里面的T（Transform），主要做数据转换，数据清洗的工作。


