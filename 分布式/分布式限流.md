# 分布式限流

## 限流算法

### 计数器限流
**概述**  
在一定周期内累加访问次数，当访问次数达到阈值时，触发限流策略，当进入下一个时间周期时，计算器会清零，重新计数。  
**适用场景**  
短信发送次数限制  
**存在问题**  
存在临界问题，对于周期比较长的限流，存在很大的弊端。

### 滑动窗口限流
**概述**  
解决了计数器限流算法的临界问题。将固定周期划分为n个小的时间段，分别在每个时间段内统计请求访问次数，
然后根据时间将窗口向前滑动并删除过期的时间段，时间段越短统计的越准，很好的解决了临界问题。  
**适用场景**  
Sentinel底层采用该算法  
**存在问题**  
窗口大小选择以及n大小的选择。

### 令牌桶限流
**概述**  
对于每一个请求，都需要先从令牌桶中获取令牌。若获取不到令牌，触发限流策略。系统会以一个恒定速率向令牌童中放入令牌，令牌中满了后直接丢弃令牌  
**适用场景**  
网络流量整形和速率限制，适合处理突发流量。当突发流量来的时候，可以直接获取令牌中所有的令牌进行快速处理。Guava底层就采用该算法  
**存在问题**  
虽然可以处理突发流量，但后台系统的压力也会瞬间增大，要合理设置令牌数量。

### 漏桶限流算法
**概述**  
控制数据注入网络的速度。在漏桶内部维护一个容器，这个容器会以恒定速率出水，不论漏桶的流入速度多快，出水的速度是固定的，消息中间件就利用了该思想  
**适用场景**  
流量平滑  
**存在问题**  
无法处理突发流量。漏桶的天然特性决定了它不会发生突发流量，就算每秒1000个请求到来，那么它对后台服务输出的访问速率永远恒定。而令牌桶则不同，其特性可以预存一定量的令牌，因此在应对突发流量的时候可以在短时间消耗所有令牌，其突发流量处理效率会比漏桶高，但是导向后台系统的压力也会相应增多
