# 交易指标

理解交易指标的计算原理与适用场景，指标不是万能的，也有其优缺点

### 策略收益

P = (P_end - P_start) / P_start

- P: 策略收益
- P_end: 统计周期内最后股票和现金的总价值
- P_start: 统计周期内最初股票和现金的总价值

### 策略年化收益

Rp = P / (n-1) * 250

- Rp: 策略年化收益
- P: 策略收益
- n: 策略执行天数
- 美股一年交易天数为252天，A股交易天数为250天

### 胜率

统计周期内所有投资盈利次数 / 统计周期内所有交易次数

### 盈亏比

统计周期内所有投资盈利单盈利之和 / 统计周期内所有亏损单的亏损之和

### 收益率
简单收益率: 相邻两个价格之间的变化率  

对数收益率: 指所有价格取对数后两两之间的差值

简单收益率不能正确的反应一个投资品的收益率。比如一个投资品今年涨了 50%，明年跌了 50%，它的算数平均收益率为 0。
但事实上，两年后该投资品亏损了最初资金的 25%。相反的，对数收益率由于具备**可加性**，它的均值可以正确反映出该投资品的真实收益率。

### 波动率
对价格变动的一种衡量，越高说明波动越明显。

`S^2={(x1-m)^2+(x2-m)2+(x3-m)2+…+(xn-m)^2}/n`,公式中`m`为数据的平均数，`n`为数据的个数,`S^2`为方差,`S`为标准差。

**年波动率**  
年波动率等于对数收益率的标准差除以其均值，再乘以交易日的平方根，通常交易日取250。

**月波动率**  
月波动率等于对数收益率的标准差除以其均值，再乘以交易月的平方根，通常交易月取12。

```python
log_return = np.diff(np.log(end_price))
print("年波动率:", end=" ")
print(log_return.std() / log_return.mean() * np.sqrt(250))

print("月波动率:", end=" ")
print(log_return.std() / log_return.mean() * np.sqrt(12))
```

### 夏普比率

夏普比率代表交易者每多承担一份风险，相应的就可以拿到几份超额报酬。若其为正值，代表回报率高过波动风险；若其为负值，代表操作风险大过于回报率。
这样，每个策略都可以计算Sharpe Ratio，即投资回报与多冒风险的比例，这个比例越高，策略越佳

夏普比率 = (Rp - Rf) / σp

- Rp: 策略年化收益率
- Rf: 无风险利率（默认0）
- σp: 策略收益波动率

### 真实波动幅度均值 ATR

ATR又称Average true range平均真实波动范围，简称ATR指标，是由J.Welles Wilder发明的。ATR指标主要是用来衡量市场波动的强烈度，即为了显示市场变化率的指标。

ATR指标的计算方法如下: 

TR=∣最高价-最低价∣，∣最高价-昨收∣，∣昨收-最低价∣中的最大值

ATR=TR的N日简单移动平均


### 凯利公式

fr = Pwin - Ploss / b

- fr: 每次交易仓位比例
- Pwin: 盈利概率
- Ploss: 亏损概率
- b: 赔率，假设一元赌局，胜利赚1元，失败亏1元，则赔率为1。如果胜利赚2元，失败亏一元，则赔率为2。即押1赔b

基于期望修正

fr = Pwin - Ploss / (profit_expectation / losses_expectation)

- profit_expectation: 盈利期望
- losses_expectation: 亏损期望